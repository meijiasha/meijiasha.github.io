<!DOCTYPE html>
<html lang="zh-Hantdiv class="spinner-border spinner-border-sm" role="status">
                        <span class="visually-hidden">處理中...</span>
                    </div>
                    處理中...
                </div>

                <div id="resultsContainer" class="mt-4" style="display: none;">
                    <h4>轉換結果：</h4>
                    <div class">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>地址轉換經緯度工具</title>
    <link rel="shortcut icon" href="LOGO.svg" type="image/x-icon" /> <!-- 您指定的 Favicon -->
    <!-- Bootstrap CSS -->
    <link href="https="result-item">
                        <strong>原始地址:</strong> <span id="resultOriginalAddress"></span>
                    </div>
                    <div class="result-item">
                        <strong>格式化地址:</strong> <span id="resultFormattedAddress"></span>
                    </div>
                    <div class="result-item">
                        <strong>緯度 (Latitude):</strong> <span id="resultLat" class="fw-bold"></span>
                    </div>
                    <div class="result-item">
                        <strong>://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding-top: 20px; padding-bottom: 20px; }
        .container { max-width: 700px; }
        #map-canvas {
            height: 300px;
            width: 100%;經度 (Longitude):</strong> <span id="resultLng" class="fw-bold"></span>
                    </div>
                    <div class="result-item">
                        <strong>Place ID (可選):</strong> <span id="resultPlaceId"></span>
                    </div>
                    <div id="mapPreview"></div>
                </div>
                <div id="errorContainer" class="alert alert-danger mt-3" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net
            margin-top: 20px;
            border: 1px solid #ccc;
        }
        .result-output {
            margin-top: 15px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="mb-4">
            <h1>地址轉換經緯度工具</h1>
            <p class="lead/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Google Maps API 腳本 (使用您的金鑰) -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCtd5KFPQASnh_nOmkACetkvgkyATSWEuw&libraries=geocoding,marker&callback=initGeocodePage&language=zh-TW&region=TW"></script>
    <!-- 注意：
        - libraries=">輸入地址，點擊轉換按鈕以獲取其經緯度座標。</p>
        </header>

        <main>
            <div class="mb-3">
                <label for="addressInput" class="form-label">輸入地址:</label>
                <input type="text" class="form-control" id="addressInput" placeholder="例如：台北市信義區市府路1號">
            </div>
            <button class="btn btn-primary" id="geocodeButton">轉換地址</button>

            <div id="resultgeocoding 是必需的
        - libraries=marker 是為了在地圖上顯示標記 (可選)
        - callback=initGeocodePage 表示 API 載入後會呼叫 initGeocodePage 函數
    -->

    <script>
        let map;
        let geocoder;
        let marker;

        // DOM 元素
        let addressInput, geocodeButton, loadingIndicator, resultsContainer, errorContainer;
        let result" class="mt-4" style="display: none;">
                <h4>轉換結果:</h4>
                <div class="result-output">
                    <p><strong>原始地址:</strong> <span id="originalAddress"></span></p>
                    <p><strong>格式化地址:</strong> <span id="formattedAddress"></span></p>
                    <p><strong>緯度 (Latitude):</strong> <span id="latitude"></span></p>
                    <p><strong>經度 (Longitude):</strong> <span id="longitude"></span></p>
                </div>
            </div>

            <div id="mapOriginalAddress, resultFormattedAddress, resultLat, resultLng, resultPlaceId;

        // API 載入後執行的初始化函數
        function initGeocodePage() {
            console.log("Google Maps API loaded for geocoding page.");
            geocoder = new google.maps.Geocoder();

            // 初始化一個預覽地圖 (可選)
            const mapPreviewDiv = document.getElementById('mapPreview');
            map = new google.maps.Map(mapPreviewDiv, {
                center: { lat: 25.-canvas" style="display: none;">
                <!-- 地圖將顯示在這裡 -->
            </div>

            <div id="error-message" class="alert alert-danger mt-3" style="display: none;" role="alert">
                <!-- 錯誤訊息 -->
            </div>
        </main>

        <footer class="mt-5 text-muted text-center">
            <p>&copy; 經緯度轉換工具</p>
        </footer>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/0330, lng: 121.5654 }, // 預設中心點 (例如台北101)
                zoom: 12,
                disableDefaultUI: true,
                zoomControl: true,
            });

            // 獲取 DOM 元素
            addressInput = document.getElementById('addressInput');
            geocodeButton = document.getElementById('geocodeButton');
            loadingIndicator = document.getElementById('loadingIndicator');
            resultsbootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Google Maps API 腳本 (使用您提供的 Key) -->
    <!-- 確保您的 API Key 已啟用 "Geocoding API" 和 "Maps JavaScript API" -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCtd5KFPQASnhContainer = document.getElementById('resultsContainer');
            errorContainer = document.getElementById('errorContainer');
            resultOriginalAddress = document.getElementById('resultOriginalAddress');
            resultFormattedAddress = document.getElementById('resultFormattedAddress');
            resultLat = document.getElementById('resultLat');
            resultLng = document.getElementById('resultLng');
            resultPlaceId = document.getElementById('resultPlaceId');


            // 綁定按鈕事件
            if (geocodeButton && addressInput) {
                geocodeButton.addEventListener('click', () => {
                    performGe_nOmkACetkvgkyATSWEuw&libraries=marker&callback=initMapTool&language=zh-TW&region=TW"></script>
    <!-- 注意：callback 改為 initMapTool，並移除了 places (除非您也想在這裡用) -->
    <!-- libraries=marker 是為了 AdvancedMarkerElement -->

    <!-- 轉換工具的 JavaScript -->
    <script src="geocode-script.js"></script>
</body>
</html>
```ocode(addressInput.value);
                });
                // 允許按 Enter 鍵觸發
                addressInput.addEventListener('keypress', (event) => {
                    if (event.key === 'Enter') {
                        event.preventDefault(); // 防止表單提交 (如果有的話)
                        performGeocode(addressInput.value);
                    }
                });
            } else {
                console.error("Geocode button or address input not found.");
                if (errorContainer) {
                    errorContainer.textContent = "頁面元素初始化失敗，請刷新。";
                    error

---

**`geocode-script.js` (完整版)**

```javascript
// geocode-script.js
console.log("geocode-script.js loaded.");

let map;
let geocoder;
let marker;

// DOM 元素
let addressInput, geocodeButton, resultDiv, originalAddressSpan, formattedAddressSpan, latitudeSpan, longitudeSpan, mapCanvas, errorMessageDiv;

function initMapTool() {
    Container.style.display = 'block';
                }
            }
        }

        // 執行地理編碼轉換
        function performGeocode(address) {
            if (!geocoder) {
                console.error("Geocoder not initialized.");
                if (errorContainer) {
                    errorContainer.textContent = "地理編碼服務未就緒，請稍後再試。";
                    errorContainer.style.display = 'block';
                }
                console.log("Google Maps API loaded, initMapTool called.");

    // DOM 元素獲取（在 API 載入後且 DOMContentLoaded 後）
    // 但為了安全，我們還是放在 DOMContentLoaded 裡
}

document.addEventListener('DOMContentLoaded', () => {
    console.log("geocode-script.js: DOMContentLoadedreturn;
            }
            if (!address || address.trim() === "") {
                if (errorContainer) {
                    errorContainer.textContent = "請輸入有效的地址。";
                    errorContainer.style.display = 'block';
                }
                if (resultsContainer) resultsContainer.style.display = 'none';
                return;
            }

            if (loadingIndicator) loadingIndicator.style.display = 'block';
            if event fired.");

    addressInput = document.getElementById('addressInput');
    geocodeButton = document.getElementById('geocodeButton');
    resultDiv = document.getElementById('result');
    originalAddressSpan = document.getElementById('originalAddress');
    formattedAddressSpan = document.getElementById('formattedAddress');
    latitudeSpan = document.getElementById('latitude');
    longitudeSpan = document.getElementById('longitude');
    mapCanvas = document.getElementById('map (resultsContainer) resultsContainer.style.display = 'none';
            if (errorContainer) errorContainer.style.display = 'none';

            console.log("Geocoding address:", address);

            geocoder.geocode({ 'address': address, 'region': 'TW' }, (results, status) => {
                if (loadingIndicator) loadingIndicator.style.display = 'none';
                if (status === 'OK') {
                    if (results &&-canvas');
    errorMessageDiv = document.getElementById('error-message');

    if (!google || !google.maps) {
        console.error("Google Maps API not fully loaded by DOMContentLoaded.");
        if (errorMessageDiv) {
            errorMessageDiv.textContent = "地圖服務載入失敗，請檢查網路連線或 API 金鑰設定。";
            errorMessageDiv.style.display = 'block';
        }
        if (geocodeButton) ge results[0]) {
                        const location = results[0].geometry.location;
                        const lat = location.lat();
                        const lng = location.lng();

                        console.log("Geocode successful:", results[0]);

                        if (resultOriginalAddress) resultOriginalAddress.textContent = address;
                        if (resultFormattedAddress) resultFormattedAddress.textContent = results[0].formatted_address;
                        if (resultLat) resultLat.textContent = lat.toFixed(6); // 保留6位小數
                        if (resultLng) resultLng.textContent = lng.toFixedocodeButton.disabled = true;
        return;
    }

    geocoder = new google.maps.Geocoder();

    // 初始化一個預設的地圖視圖 (例如台北市中心)
    const initialPosition = { lat: 25.0329694, lng: 121.5654177 }; // 台北101
    map = new google.maps.Map(map(6);
                        if (resultPlaceId) resultPlaceId.textContent = results[0].place_id || 'N/A';

                        if (resultsContainer) resultsContainer.style.display = 'block';

                        // 更新地圖預覽
                        if (map) {
                            map.setCenter(location);
                            map.setZoom(17); // 放大到街道級別
                            if (marker) {
                                marker.Canvas, {
        center: initialPosition,
        zoom: 12,
        mapId: "GEOCODE_DEMO_MAP_ID" // 可選，如果您有 Map ID
    });

    if (geocodeButton && addressInput) {
        geocodeButton.addEventListener('click', performGeocode);
        addressInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); //setMap(null); // 清除舊標記
                            }
                            marker = new google.maps.marker.AdvancedMarkerElement({ // 使用新的 Marker
                                map: map,
                                position: location,
                                title: results[0].formatted_address
                            });
                        }
                    } else {
                        console.warn("Geocode was successful but no results found.");
                        if (errorContainer) {
                            errorContainer.textContent = " 防止表單提交（如果有的話）
                performGeocode();
            }
        });
    } else {
        console.error("Required elements (geocodeButton or addressInput) not found.");
    }
});

async function performGeocode() {
    const address = addressInput ? addressInput.value : '';

    if (!address.trim()) {
        displayError("請輸入一個有效的地址。");
        return;
    }

找不到該地址的座標，請確認地址是否正確。";
                            errorContainer.style.display = 'block';
                        }
                    }
                } else {
                    console.error("Geocode failed due to: " + status);
                    let userMessage = "地址轉換失敗，請稍後再試。";
                    if (status === 'ZERO_RESULTS') {
                        userMessage = "找不到該地址的座標，請確認地址是否正確。    if (!geocoder) {
        displayError("Geocoding 服務尚未初始化。");
        return;
    }

    console.log(`Attempting to geocode address: ${address}`);
    if (resultDiv) resultDiv.style.display = 'none';
    if (mapCanvas) mapCanvas.style.display = 'none';
    if (errorMessageDiv) errorMessageDiv.style.display = 'none';
    if (geocodeButton) geocodeButton.disabled = true; // 禁用按鈕防止重複點擊
    if";
                    } else if (status === 'OVER_QUERY_LIMIT') {
                        userMessage = "已超出查詢配額，請稍後再試或檢查您的 API 金鑰設定。";
                    } else if (status === 'REQUEST_DENIED') {
                        userMessage = "請求被拒絕，可能是 API 金鑰無效或未啟用 Geocoding API。";
                    } else if (status === 'INVALID_REQUEST') {
                        userMessage = "請求無效，請檢查輸入的地址。";
                    }
                    if (errorContainer) { (geocodeButton) geocodeButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> 轉換中...';


    geocoder.geocode({ 'address': address, 'region': 'TW' }, async (results, status) => { // 限定在台灣區域
        if (geocodeButton) geocodeButton.disabled = false; // 重新啟用按鈕
        if (geocodeButton) geocodeButton.innerHTML = '轉換地址';

        if (status === 'OK') {
            if (results && results[
                        errorContainer.textContent = userMessage + ` (錯誤碼: ${status})`;
                        errorContainer.style.display = 'block';
                    }
                }
            });
        }
    </script>
</body>
</html>