<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>咩呷啥 - 今天吃什麼</title>

  <script src="config.js"></script>

  <!-- Google Fonts: Noto Sans TC -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
  <!-- Bootstrap 圖示 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />
  <!-- 自訂 CSS -->
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <!-- 側邊欄 (Offcanvas) -->
  <div class="sidebar offcanvas offcanvas-start" tabindex="-1" id="sidebar" aria-labelledby="sidebarOffcanvasLabel">
    <div class="sidebar-header">
      <img src="LOGO.svg" alt="咩呷啥 Logo" class="logo" />
      <h5 class="sidebar-title" id="sidebarOffcanvasLabel">店家篩選 (台北市)</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="sidebar-body">
      <!-- 行政區選擇 -->
      <div class="mb-3">
        <label for="districtSelect" class="form-label">選擇行政區:</label>
        <select class="form-select" id="districtSelect">
          <option selected disabled value="">-- 請選擇 --</option>
          <!-- 選項將由 JS 填入 -->
        </select>
      </div>
      <!-- 分類列表 -->
      <div class="mb-3">
        <h6>分類:</h6>
        <select class="form-select" id="categorySelect" disabled>
          <option selected disabled value="">-- 請先選擇行政區 --</option>
        </select>
      </div>
      <!-- 營業時間過濾 -->
      <div class="form-check form-switch mb-3">
        <input class="form-check-input" type="checkbox" role="switch" id="openNowFilter">
        <label class="form-check-label" for="openNowFilter">僅顯示營業中</label>
      </div>
      <!-- 按鈕區域 -->
      <div class="d-grid gap-2">
        <button class="btn btn-outline-success" type="button" id="randomRecommendBtn" disabled><i
            class="bi bi-shuffle"></i> 隨機推薦店家 (同區域)</button>
        <button class="btn btn-outline-info mt-2" type="button" id="listAllStoresBtn" disabled><i
            class="bi bi-card-list"></i> 列出本行政區所有店家</button>
        <button class="btn btn-outline-primary mt-2" type="button" id="recommendNearbyBtn" disabled><i
            class="bi bi-geo-alt-fill"></i> 推薦附近店家</button>
      </div>
      <!-- 隨機推薦結果 -->
      <div id="random-recommendation-result" class="mt-4"></div>
      <hr />
      <p class="small text-muted"><a href="https://www.god-dice.com/" target="_blank"><img src="i/banner-sponsor.jpg"
            alt="贊助商 上帝骰 LOGO 圖片" style="width:75%;margin:0 auto;"></a></p>
    </div>
  </div>

  <!-- 主要內容區域 -->
  <div class="main-content">
    <!-- 導覽列 -->
    <nav class="navbar navbar-expand-lg glass-navbar">
      <div class="container-fluid">
        <!-- Sidebar Toggler (Mobile) -->
        <button class="navbar-toggler d-md-none me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar"
          aria-controls="sidebar" aria-label="Toggle sidebar">
          <i class="bi bi-list"></i>
        </button>
        <a class="navbar-brand fw-bold" href="#">咩呷啥</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
          aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#aboutUsModal">關於我們</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#featuresModal">功能介紹</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#techStackModal">技術堆疊</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#lineBotModal"><i
                  class="bi bi-line"></i> LINE Bot</a>
            </li>
          </ul>
          <!-- Dark Mode Switch -->
          <div class="form-check form-switch mx-auto me-lg-3" title="切換深色模式">
            <input class="form-check-input" type="checkbox" role="switch" id="darkModeSwitch">
            <label class="form-check-label" for="darkModeSwitch" id="darkModeLabel"><i
                class="bi bi-moon-stars-fill"></i></label>
          </div>
          <!-- 搜尋功能已移除 -->
        </div>
      </div>
    </nav>

    <!-- 推薦卡片容器 -->
    <div id="recommendation-tray" class="recommendation-tray">
      <div class="recommendation-header">
        <div id="recommendation-summary" class="recommendation-summary"></div>
        <button id="recommendation-toggle-btn" class="btn btn-sm btn-light">
          <i class="bi bi-chevron-down"></i>
        </button>
      </div>
      <div id="recommendation-cards-container" class="recommendation-cards-container"></div>
    </div>

    <!-- 搜尋結果面板已移除 -->

    <!-- 地圖容器 -->
    <div id="map"></div>
  </div>

  <!-- 全行政區店家列表面板 -->
  <div id="all-stores-panel" class="all-stores-panel">
    <div class="panel-header">
      <h5 id="all-stores-panel-title">所有店家</h5>
      <button type="button" id="close-all-stores-panel" class="btn-close" aria-label="Close"></button>
    </div>
    <div id="all-stores-panel-content" class="list-group list-group-flush"></div>
    <nav id="all-stores-panel-pagination" class="mt-auto p-2" aria-label="Page navigation"></nav>
  </div>

  <!-- Modal 區域 -->
  <!-- 關於我們 Modal -->
  <div class="modal fade" id="aboutUsModal" tabindex="-1" aria-labelledby="aboutUsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="aboutUsModalLabel">關於我們</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>「咩呷啥」是一個畢業製作專題，旨在解決「今天吃什麼？」這個千古難題。</p>
          <p>我們希望透過這個平台，讓使用者可以輕鬆探索附近的美食，並透過簡單直觀的介面，快速找到想吃的店家。</p>
          <p>感謝您的使用與支持！</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 功能介紹 Modal -->
  <div class="modal fade" id="featuresModal" tabindex="-1" aria-labelledby="featuresModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="featuresModalLabel">功能介紹</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <ul>
            <li><strong>行政區與分類篩選</strong>: 從側邊欄選擇行政區和店家分類，快速縮小搜尋範圍。</li>
                        <li><strong>隨機推薦</strong>: 不知道吃什麼？讓系統為您隨機推薦店家，還能針對特定分類進行推薦。</li>
            <li><strong>店家詳細資訊</strong>: 點擊地圖上的標記或列表中的店家，查看營業時間、評價、地址等詳細資訊。</li>
          </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 技術堆疊 Modal -->
  <div class="modal fade" id="techStackModal" tabindex="-1" aria-labelledby="techStackModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="techStackModalLabel">技術堆疊</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between align-items-center">
              前端
              <span class="badge bg-primary rounded-pill">HTML, CSS, JavaScript, Bootstrap 5</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              地圖服務
              <span class="badge bg-primary rounded-pill">Google Maps API</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              後端與資料庫
              <span class="badge bg-primary rounded-pill">Firebase</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              開發協助
              <span class="badge bg-success rounded-pill">Gemini AI</span>
            </li>
          </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
        </div>
      </div>
    </div>
  </div>

  <!-- LINE Bot Modal -->
  <div class="modal fade" id="lineBotModal" tabindex="-1" aria-labelledby="lineBotModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="lineBotModalLabel"><i class="bi bi-line"></i> 加入我們的 LINE Bot</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <p>掃描下方的 QR Code，或點擊按鈕來加入「咩呷啥」LINE Bot，隨時隨地推薦美食！</p>
          <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://lin.ee/Qn1ZQIx"
            alt="LINE Bot QR Code" class="img-fluid my-3">
          <div class="d-grid">
            <a href="https://lin.ee/Qn1ZQIx" target="_blank" class="btn btn-success btn-lg"><i class="bi bi-line"></i>
              點此加入</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- **腳本載入區 (順序重要)** -->

  <!-- 1. Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>

  <!-- 2. Firebase SDK (Compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js?version=1"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js?version=1"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js?version=1"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-functions-compat.js?version=1"></script>

  <!-- 3. Firebase 初始化 (使用 Compat 語法) -->
  <script>
    // ========================================================
    // == 重要：請務必填入您真實的 Firebase 設定 ==
    // ========================================================
    const firebaseConfig = {
      apiKey: FIREBASE_API_KEY,
      authDomain: "meijiasha-64de6.firebaseapp.com",
      projectId: "meijiasha-64de6",
      storageBucket: "meijiasha-64de6.firebasestorage.app",
      messagingSenderId: "732275424686",
      appId: "1:732275424686:web:9e1349c421503f75da5c3f",
      measurementId: "G-07JZNDTJN7",
    };

    // 初始化 Firebase 並定義全域 db 變數
    try {
      firebase.initializeApp(firebaseConfig);
      var db = firebase.firestore(); // 使用 var 或直接 db = ... 使其可在 script.js 中訪問
      console.log("HTML: Firebase Initialized Successfully (Compat Mode). 'db' should be available.");
    } catch (error) {
      console.error("HTML: Firebase Initialization Failed:", error);
      alert("Firebase 初始化失敗，請檢查設定物件或網路連線。");
      var db = null; // 明確設置為 null，讓 script.js 中的檢查能捕捉到
    }
  </script>

  <!-- 4. 您的主要自訂 JavaScript 檔案 -->
  <script src="script.js"></script>
</body>

</html>