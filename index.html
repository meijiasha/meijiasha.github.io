<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>咩呷啥 - 今天吃什麼</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
    <!-- Bootstrap 圖示 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />
    <!-- 自訂 CSS (確認檔名為 style.css 或您使用的名稱) -->
    <link rel="stylesheet" href="style.css" />

    <!-- PWA & App Install -->
    <meta name="theme-color" content="#F55D3E">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="LOGO.svg">
  </head>
  <body>
    <!-- 側邊欄 -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <img src="LOGO.svg" alt="咩呷啥 Logo" class="logo" />
            <h5 class="sidebar-title" id="sidebarOffcanvasLabel">店家篩選 (台北市)</h5>
        </div>
        <div class="sidebar-body">
            <!-- 行政區選擇 (ID: districtSelect) -->
            <div class="mb-3">
                <label for="districtSelect" class="form-label">選擇行政區:</label>
                <select class="form-select" id="districtSelect">
                    <option selected disabled value="">-- 請選擇 --</option>
                    <!-- 選項將由 JS 填入 -->
                </select>
            </div>
            <!-- 分類列表 -->
          <div class="mb-3">
            <h6>分類:</h6>
            <select class="form-select" id="categorySelect" disabled>
              <option selected disabled value="">-- 請先選擇行政區 --</option>
            </select>
          </div>
            <!-- 營業時間過濾 -->
            <div class="form-check form-switch mb-3">
              <input class="form-check-input" type="checkbox" role="switch" id="openNowFilter">
              <label class="form-check-label" for="openNowFilter">僅顯示營業中</label>
            </div>
            <!-- 隨機按鈕 (ID: randomRecommendBtn) -->
            <div class="d-grid gap-2">
                <button class="btn btn-outline-success" type="button" id="randomRecommendBtn" disabled><i class="bi bi-shuffle"></i> 隨機推薦店家 (同區域)</button>
            </div>
            <!-- 隨機推薦結果 -->
            <div id="random-recommendation-result" class="mt-4"></div>
            <hr />
            <p class="small text-muted">其他側邊欄內容...</p>
        </div>
    </div>

    <!-- 主要內容區域 -->
    <div class="main-content">
        <!-- 導覽列 -->
        <nav class="navbar navbar-expand-lg glass-navbar">
            <div class="container-fluid">
                <a class="navbar-brand fw-bold" href="#">咩呷啥</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#aboutUsModal">關於我們</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#featuresModal">功能介紹</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#techStackModal">技術堆疊</a>
                        </li>
                    </ul>
                    <!-- Dark Mode Switch -->
                    <div class="form-check form-switch mx-auto me-lg-3" title="切換深色模式">
                        <input class="form-check-input" type="checkbox" role="switch" id="darkModeSwitch">
                        <label class="form-check-label" for="darkModeSwitch" id="darkModeLabel"><i class="bi bi-moon-stars-fill"></i></label>
                    </div>
                    <!-- 搜尋框 (可選, ID: searchContainer, searchButton, searchInput) -->
                    <div class="search-container">
                        <button class="search-button" id="searchButton"><i class="bi bi-search"></i></button>
                        <input type="search" class="search-input" id="searchInput" placeholder="搜尋地點(全地圖)..." />
                    </div>
                </div>
            </div>
        </nav>

        <!-- 搜尋結果面板 -->
        <div id="search-results-container" style="display: none;"></div>
        
        <!-- 地圖容器 (ID: map) -->
        <div id="map">
            <!-- 地圖會載入這裡 -->
        </div>
    </div>

    <!-- Modal 區域 -->
    <!-- 關於我們 Modal -->
    <div class="modal fade" id="aboutUsModal" tabindex="-1" aria-labelledby="aboutUsModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="aboutUsModalLabel">關於我們</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>「咩呷啥」是一個畢業製作專題，旨在解決「今天吃什麼？」這個千古難題。</p>
            <p>我們希望透過這個平台，讓使用者可以輕鬆探索附近的美食，並透過簡單直觀的介面，快速找到想吃的店家。</p>
            <p>感謝您的使用與支持！</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 功能介紹 Modal -->
    <div class="modal fade" id="featuresModal" tabindex="-1" aria-labelledby="featuresModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="featuresModalLabel">功能介紹</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <ul>
              <li><strong>行政區與分類篩選</strong>: 從側邊欄選擇行政區和店家分類，快速縮小搜尋範圍。</li>
              <li><strong>地圖搜尋</strong>: 在右上角輸入任何地點，尋找該地點附近的店家。</li>
              <li><strong>隨機推薦</strong>: 不知道吃什麼？讓系統為您隨機推薦店家，還能針對特定分類進行推薦。</li>
              <li><strong>店家詳細資訊</strong>: 點擊地圖上的標記或列表中的店家，查看營業時間、評價、地址等詳細資訊。</li>
            </ul>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 技術堆疊 Modal -->
    <div class="modal fade" id="techStackModal" tabindex="-1" aria-labelledby="techStackModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="techStackModalLabel">技術堆疊</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <ul class="list-group">
              <li class="list-group-item d-flex justify-content-between align-items-center">
                前端
                <span class="badge bg-primary rounded-pill">HTML, CSS, JavaScript, Bootstrap 5</span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                地圖服務
                <span class="badge bg-primary rounded-pill">Google Maps API</span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                後端與資料庫
                <span class="badge bg-primary rounded-pill">Firebase</span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                開發協助
                <span class="badge bg-success rounded-pill">Gemini AI</span>
              </li>
            </ul>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
          </div>
        </div>
      </div>
    </div>

    <!-- **腳本載入區 (順序重要)** -->

    <!-- 1. Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <!-- 2. Firebase SDK (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js?version=1"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js?version=1"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js?version=1"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-functions-compat.js?version=1"></script>

    <!-- 3. Firebase 初始化 (使用 Compat 語法) -->
    <script>
      // ========================================================
      // == 重要：請務必填入您真實的 Firebase 設定 ==
      // ========================================================
      const firebaseConfig = {
        apiKey: "AIzaSyA4sQav5EeZowQKRya14xeG9Lj3TyMQdM4",
        authDomain: "meijiasha-64de6.firebaseapp.com",
        projectId: "meijiasha-64de6",
        storageBucket: "meijiasha-64de6.firebasestorage.app",
        messagingSenderId: "732275424686",
        appId: "1:732275424686:web:9e1349c421503f75da5c3f",
        measurementId: "G-07JZNDTJN7",
        //apiKey: "YOUR_FIREBASE_API_KEY", // <--- 替換這裡
        //authDomain: "meijiasha-64de6.firebaseapp.com", // <--- 替換這裡 (PROJECT_ID)
        //projectId: "meijiasha-64de6", // <--- 替換這裡
        //storageBucket: "meijiasha-64de6.appspot.com", // <--- 替換這裡 (PROJECT_ID)
        //messagingSenderId: "YOUR_SENDER_ID", // <--- 替換這裡
        //appId: "YOUR_APP_ID", // <--- 替換這裡
        // measurementId: "G-XXXXXXXXXX" // 通常 Firestore 不需要這個
      };

      // 初始化 Firebase 並定義全域 db 變數
      try {
        firebase.initializeApp(firebaseConfig);
        var db = firebase.firestore(); // 使用 var 或直接 db = ... 使其可在 script.js 中訪問
        console.log("HTML: Firebase Initialized Successfully (Compat Mode). 'db' should be available.");
      } catch (error) {
        console.error("HTML: Firebase Initialization Failed:", error);
        alert("Firebase 初始化失敗，請檢查設定物件或網路連線。");
        // 考慮是否讓使用者知道 db 無法使用
        var db = null; // 明確設置為 null，讓 script.js 中的檢查能捕捉到
      }
    </script>

    <!-- 4. Google Maps API 腳本 -->
    <!-- ======================================================== -->
    <!-- == 重要：請務必填入您真實的 Google Maps API 金鑰 == -->
    <!-- ======================================================== -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCtd5KFPQASnh_nOmkACetkvgkyATSWEuw&libraries&callback=initMap&libraries=places,marker&v=beta&language=zh-TW®ion=TW"></script>

    <!-- 5. 您的主要自訂 JavaScript 檔案 -->
    <!-- (確認檔名為 script.js 或您使用的名稱) -->
    <script src="script.js"></script>
  </body>
</html>